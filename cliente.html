<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>√Årea do Cliente - Yuri Celulares</title>
    <style>
        :root {
            --primary: #007bff;
            --accent: #6c757d;
            --bg: #0a0a0b;
            --card-bg: #161b22;
            --text: #f0f6fc;
            --success: #2ea043;
            --danger: #f85149;
        }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 20px; }
        .container { max-width: 500px; margin: auto; }
        h1 { color: var(--primary); text-transform: uppercase; letter-spacing: 2px; font-size: 22px; }
        
        .card { background: var(--card-bg); border: 1px solid #30363d; padding: 20px; border-radius: 12px; margin-bottom: 20px; text-align: left; box-shadow: 0 4px 10px rgba(0,0,0,0.3); }
        .status-badge { background: var(--primary); color: white; padding: 5px 12px; border-radius: 20px; font-size: 12px; font-weight: bold; display: inline-block; margin-bottom: 10px; }
        
        .modelo { font-size: 18px; font-weight: bold; margin: 5px 0; display: block; }
        .info { font-size: 13px; color: #8b949e; margin-bottom: 5px; }
        
        .alerta-desligado { color: var(--danger); font-size: 12px; font-weight: bold; margin-bottom: 10px; border: 1px solid var(--danger); padding: 5px; border-radius: 5px; display: inline-block; }

        .fotos-galeria { display: flex; gap: 10px; overflow-x: auto; margin-top: 15px; padding-bottom: 10px; }
        .foto-item { width: 120px; height: 120px; object-fit: cover; border-radius: 8px; border: 1px solid var(--primary); flex-shrink: 0; cursor: pointer; }

        .garantia-box { background: rgba(46, 160, 67, 0.15); border: 1px solid var(--success); color: #7ee787; padding: 10px; border-radius: 8px; font-size: 14px; margin-top: 10px; display: flex; align-items: center; justify-content: center; gap: 8px; }
        .btn-novo { background: var(--primary); color: white; border: none; padding: 15px; width: 100%; border-radius: 8px; font-weight: bold; font-size: 16px; cursor: pointer; margin-top: 10px; transition: 0.3s; text-decoration: none; display: block; text-align: center; }
        
        .checklist-view { background: #0d1117; padding: 10px; border-radius: 8px; margin-top: 10px; border-left: 3px solid var(--primary); }
        .checklist-view summary { font-size: 13px; cursor: pointer; color: var(--primary); font-weight: bold; }
        .item-check { font-size: 12px; display: flex; justify-content: space-between; padding: 4px 0; border-bottom: 1px solid #21262d; }
        .val { font-weight: bold; }
        .val.OK { color: #2ea043; }
        .val.NOK { color: #f85149; }
    </style>
</head>
<body>
    <div class="container">
        <h1>YURI CELULARES</h1>
        <p style="color: #8b949e;">Portal de Acompanhamento</p>

        <div id="historico">
            <p>Buscando seu hist√≥rico...</p>
        </div>

        <a href="/" class="btn-novo">+ NOVO OR√áAMENTO</a>
        
        <p style="font-size: 11px; color: #484f58; margin-top: 30px;">Yuri Celulares &copy; 2026 - Assist√™ncia T√©cnica Especializada</p>
    </div>

    <script>
        async function atualizarPagina() {
            const cpf = localStorage.getItem('yuri_cpf');
            if(!cpf) {
                document.getElementById('historico').innerHTML = "<p>Nenhum dado encontrado.</p>";
                return;
            }

            try {
                const res = await fetch('/historico/' + cpf);
                const dados = await res.json();

                if(dados.length === 0) {
                    document.getElementById('historico').innerHTML = "<p>Nenhuma ordem encontrada.</p>";
                    return;
                }

                let html = "";
                dados.reverse().forEach(os => {
                    html += `<div class="card">`;
                    html += `<div class="status-badge">${os.status.toUpperCase()}</div>`;
                    
                    if(os.desligado) {
                        html += `<div class="alerta-desligado">‚ö†Ô∏è Aparelho entregue desligado</div>`;
                    }

                    html += `<span class="modelo">${os.modelo}</span>`;
                    html += `<div class="info"><b>Entrada:</b> ${os.data_registro || 'Recentemente'}</div>`;
                    html += `<div class="info"><b>üìç Endere√ßo:</b> ${os.endereco || 'N√£o informado'}</div>`;

                    if(os.fotos && os.fotos.length > 0) {
                        html += `<p style="font-size:12px; margin-bottom:5px; margin-top:10px;">üì∑ Fotos do Aparelho:</p><div class="fotos-galeria">`;
                        os.fotos.forEach(foto => {
                            html += `<img src="${foto}" class="foto-item" onclick="window.open(this.src)">`;
                        });
                        html += `</div>`;
                    }

                    if(os.garantia_total) {
                        html += `<div class="garantia-box">üõ°Ô∏è Garantia de ${os.garantia_total} dias</div>`;
                    }

                    if(os.checklist_tecnico) {
                        html += `<details class="checklist-view" open>
                                    <summary>Relat√≥rio T√©cnico</summary>
                                    <div style="margin-top:10px;">`;
                        for(let item in os.checklist_tecnico) {
                            let status = os.checklist_tecnico[item];
                            html += `<div class="item-check">
                                        <span>${item}</span>
                                        <span class="val ${status}">${status}</span>
                                     </div>`;
                        }
                        html += `</div></details>`;
                    }
                    html += `</div>`;
                });
                document.getElementById('historico').innerHTML = html;
            } catch (e) { console.log("Erro ao buscar dados"); }
        }
        atualizarPagina();
        setInterval(atualizarPagina, 10000);
    </script>
</body>
</html>
